# Copyright 2015 Intel Corporation.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# ###########################
# Common setting potentially accessed by all components.
# ###########################

import os
import copy

# default language and encoding, which will be set in case
# that locale is not set properly
DEFAULT_LOCALE = 'en_US.UTF-8'

# default language and encoding, which will be used by external
# commands; This values will be set in case, that VSPERF parses
# command output.
DEFAULT_CMD_LOCALE = 'en_US.UTF-8'

# DPDK target used when builing DPDK
RTE_TARGET = 'x86_64-native-linuxapp-gcc'

# ############################
# Directories
# ############################

ROOT_DIR = os.path.normpath(os.path.join(
    os.path.dirname(os.path.realpath(__file__)), '../'))
TRAFFICGEN_DIR = os.path.join(ROOT_DIR, 'tools/pkt_gen')
SYSMETRICS_DIR = os.path.join(ROOT_DIR, 'tools/collectors')

PATHS_TYPE = 'src' # or 'bin'

PATHS = {
    'vswitch': {
        'OvsDpdkVhost': {
            'src': {
                'path': os.path.join(ROOT_DIR, 'src/ovs/ovs/'),
                'ovs-vswitchd': 'vswitchd/ovs-vswitchd',
                'ovsdb-server': 'ovsdb/ovsdb-server',
                'ovsdb-tool': 'ovsdb/ovsdb-tool',
                'ovsschema': 'vswitchd/vswitch.ovsschema',
                'ovs-vsctl': 'utilities/ovs-vsctl',
                'ovs-ofctl': 'utilities/ovs-ofctl',
                'ovs-dpctl': 'utilities/ovs-dpctl',
                'ovs-appctl': 'utilities/ovs-appctl',
            },
            'bin': {
                'ovs-vswitchd': 'ovs-vswitchd',
                'ovsdb-server': 'ovsdb-server',
                'ovsdb-tool': 'ovsdb-tool',
                'ovsschema': '/usr/share/openvswitch/vswitch.ovsschema',
                'ovs-vsctl': 'ovs-vsctl',
                'ovs-ofctl': 'ovs-ofctl',
                'ovs-dpctl': 'ovs-dpctl',
                'ovs-appctl': 'ovs-appctl',
            }
        },
        'ovs_var': '/usr/local/var/run/openvswitch/',
        'ovs_etc': '/usr/local/etc/openvswitch/',
    },
    'dpdk': {
        'src': {
            'path': os.path.join(ROOT_DIR, 'src/dpdk/dpdk/'),
            # To use vfio set:
            # 'modules' : ['uio', 'vfio-pci']
            'modules' : ['uio', 'cuse', os.path.join(RTE_TARGET, 'kmod/igb_uio.ko')],
            'bind-tool': 'tools/dpdk*bind.py',
            'testpmd': os.path.join(RTE_TARGET, 'app', 'testpmd'),
        },
        'bin': {
            'bind-tool': '/usr/share/dpdk/tools/dpdk*bind.py',
            'modules' : ['uio', 'cuse', 'igb_uio'],
            'testpmd' : 'testpmd'
        }
    },
    'qemu' : {
        'src': {
            'path': os.path.join(ROOT_DIR, 'src/qemu/qemu/'),
            'qemu-system': 'x86_64-softmmu/qemu-system-x86_64'
        },
        'bin': {
            'qemu-system': 'qemu-system-x86_64'
        }
    }
}
PATHS['vswitch'].update({'OvsVanilla' : copy.deepcopy(PATHS['vswitch']['OvsDpdkVhost'])})
PATHS['vswitch']['OvsVanilla']['src']['path'] = os.path.join(ROOT_DIR, 'src_vanilla/ovs/ovs/')
PATHS['vswitch']['OvsVanilla']['src']['modules'] = ['datapath/linux/openvswitch.ko']

# ############################
# Process configuration
# ############################

# shell command to use when running commands through Pexpect
SHELL_CMD = ['/bin/bash', '-c']

# ############################
# Logging configuration
# ############################

# default log output directory for all logs
LOG_DIR = '/tmp'

# default log for all "small" executables
LOG_FILE_DEFAULT = 'overall.log'

# log file for all commands executed on host
LOG_FILE_HOST_CMDS = 'host-cmds.log'

# ############################
# Test configuration
# ############################

# verbosity of output to 'stdout'
# NOTE: output to log files is always 'debug' level
VERBOSITY = 'debug'

# dictionary of test-specific parameters. These values are accessible
# from anywhere in the test framework so be careful with naming
# conventions
TEST_PARAMS = {}

# ############################
# Modules
# ############################

# following modules will be excluded from automatic load by LoaderServant
# it can be used to suppress automatic load of obsoleted or abstract modules
# Example:
#   EXCLUDE_MODULES = ['ovs_vanilla', 'qemu_virtio_net', 'pidstat']
EXCLUDE_MODULES = ["testcenter-rfc2544-throughput"]
